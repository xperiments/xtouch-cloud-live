<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>xtouch cloud live</title>

    <!-- Meta tags for mobile bookmarking -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="XTouch Cloud Live" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link rel="apple-touch-icon" href="img/xcloud.png" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="img/cloud.ico" type="image/x-icon" />
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #000;
        color: #23a543;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      * {
        box-sizing: border-box;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      #message {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #23a543;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 10;
      }
      .xtouch-logo {
        padding: 16px;
        width: 100%;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <div class="xtouch-logo">
      <svg
        class="xtouch-logo-svg"
        height="26"
        viewBox="0 0 203 46"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill="#23A543"
          d="M186.158 14.64c3.146 0 5.813.587 8 1.76 2.186 1.173 3.84 2.533 4.96 4.08 1.44 1.653 2.399 3.467 2.879 5.44.534 1.813.801 3.6.801 5.36v9.76c0 1.387-.507 2.56-1.521 3.52-1.013.96-2.133 1.44-3.36 1.44-1.386 0-2.559-.48-3.519-1.44-.96-1.12-1.44-2.293-1.44-3.52v-9.76l-.241-1.92a5.06 5.06 0 0 0-.88-2.24c-.426-.747-1.119-1.36-2.079-1.84-.907-.533-2.107-.8-3.6-.8-1.494 0-2.907-.16-4.241-.48-1.333-.32-2.533-.72-3.599-1.2-2.187-1.227-3.947-2.667-5.28-4.32-1.28-1.653-2.16-3.227-2.64-4.72-.427-1.547-.694-2.693-.8-3.44-.107-.8-.16-1.68-.16-2.64V5.92c0-1.387.48-2.56 1.44-3.52 1.12-.96 2.293-1.44 3.52-1.44 1.333 0 2.479.48 3.439 1.44.96 1.12 1.44 2.293 1.44 3.52v1.76c.107.48.161 1.147.161 2 .266 1.013.586 1.787.96 2.32a6.425 6.425 0 0 0 2.159 2c.854.427 2.054.64 3.601.64Zm-11.76 10.76c1.333 0 2.479.507 3.439 1.52s1.44 2.133 1.44 3.36v10.76c0 1.387-.506 2.56-1.519 3.52-1.014.96-2.134 1.44-3.36 1.44-1.387 0-2.56-.48-3.52-1.44-.96-1.12-1.44-2.293-1.44-3.52V30.28c0-1.333.48-2.48 1.44-3.44 1.12-.96 2.293-1.44 3.52-1.44ZM149.595 22.48l-1.92.24a4.949 4.949 0 0 0-2.4.8c-.747.48-1.36 1.2-1.84 2.16-.48.96-.72 2.16-.72 3.6 0 1.6.24 2.853.72 3.76.587.853 1.227 1.52 1.92 2 .427.32.827.56 1.2.72.373.107.747.187 1.12.24l1.92.16h11.76c1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c0 1.387-.507 2.56-1.52 3.52s-2.133 1.44-3.36 1.44h-11.76a118.082 118.082 0 0 1-2.88-.32 43.972 43.972 0 0 1-2.56-.56 22.718 22.718 0 0 1-5.36-2.88 17.04 17.04 0 0 1-2.4-2.4 27.138 27.138 0 0 1-1.84-2.72c-1.12-2.187-1.68-4.8-1.68-7.84 0-1.547.133-2.987.4-4.32.32-1.333.747-2.48 1.28-3.44 1.173-2.293 2.587-4.027 4.24-5.2 1.707-1.44 3.467-2.4 5.28-2.88 1.867-.533 3.707-.8 5.52-.8h11.76c1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c0 1.387-.507 2.56-1.52 3.52s-2.133 1.44-3.36 1.44h-11.76ZM124.793 12.64c1.333 0 2.479.507 3.439 1.52s1.441 2.133 1.441 3.36v11.76c0 .8-.081 1.733-.241 2.8a26.746 26.746 0 0 1-.56 2.72 17.808 17.808 0 0 1-2.879 5.44c-1.281 1.6-2.987 2.96-5.121 4.08-2.08 1.12-4.693 1.68-7.839 1.68-1.494 0-2.907-.16-4.24-.48-1.334-.32-2.534-.72-3.601-1.2-2.133-1.173-3.866-2.56-5.2-4.16a15.63 15.63 0 0 1-2.8-5.36c-.373-1.12-.613-1.973-.72-2.56-.106-.64-.16-1.627-.16-2.96V17.52c0-1.333.48-2.48 1.44-3.44 1.12-.96 2.294-1.44 3.52-1.44 1.334 0 2.481.507 3.441 1.52s1.44 2.133 1.44 3.36v11.76c.106.427.159 1.067.159 1.92.267 1.013.587 1.787.96 2.32a6.431 6.431 0 0 0 2.161 2c.853.427 2.053.64 3.6.64 1.493 0 2.693-.24 3.599-.72 1.067-.693 1.814-1.387 2.24-2.08.48-.747.72-1.467.72-2.16.16-.533.24-1.173.24-1.92V17.52c0-1.333.48-2.48 1.44-3.44 1.12-.96 2.294-1.44 3.521-1.44ZM76.47 12.64c3.147 0 5.813.587 8 1.76 2.187 1.173 3.84 2.533 4.96 4.08 1.44 1.653 2.4 3.467 2.88 5.44.533 1.813.8 3.6.8 5.36 0 .8-.08 1.733-.24 2.8a26.938 26.938 0 0 1-.56 2.72 17.789 17.789 0 0 1-2.88 5.44c-1.28 1.6-2.987 2.96-5.12 4.08-2.08 1.12-4.693 1.68-7.84 1.68a18.12 18.12 0 0 1-4.24-.48c-1.333-.32-2.533-.72-3.6-1.2-2.133-1.173-3.867-2.56-5.2-4.16a15.63 15.63 0 0 1-2.8-5.36c-.373-1.12-.613-1.973-.72-2.56-.107-.64-.16-1.627-.16-2.96a61.86 61.86 0 0 1 .32-2.8c.16-.8.347-1.653.56-2.56a20.449 20.449 0 0 1 2.88-5.44c1.44-1.76 3.2-3.173 5.28-4.24 2.08-1.067 4.64-1.6 7.68-1.6Zm0 23.52c1.493 0 2.693-.24 3.6-.72 1.067-.693 1.813-1.387 2.24-2.08.48-.747.72-1.467.72-2.16.16-.533.24-1.173.24-1.92l-.24-1.92c-.107-.8-.4-1.547-.88-2.24-.427-.747-1.12-1.36-2.08-1.84-.907-.533-2.107-.8-3.6-.8-1.547 0-2.8.267-3.76.8-.533.267-.933.533-1.2.8-.213.213-.48.533-.8.96-.32.427-.56.827-.72 1.2-.107.32-.187.693-.24 1.12l-.16 1.92c.107.427.16 1.067.16 1.92.267 1.013.587 1.787.96 2.32a6.432 6.432 0 0 0 2.16 2c.853.427 2.053.64 3.6.64ZM53.892 36.16c1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c0 1.387-.507 2.56-1.52 3.52-1.014.96-2.134 1.44-3.36 1.44a18.12 18.12 0 0 1-4.24-.48c-1.334-.32-2.534-.72-3.6-1.2-2.133-1.173-3.867-2.56-5.2-4.16a15.628 15.628 0 0 1-2.8-5.36c-.373-1.12-.614-1.973-.72-2.56-.107-.64-.16-1.627-.16-2.96V5.68c0-1.387.48-2.56 1.44-3.52 1.12-.96 2.293-1.44 3.52-1.44 1.333 0 2.48.48 3.44 1.44.96 1.12 1.44 2.293 1.44 3.52v23.6c.106.427.16 1.067.16 1.92.267 1.013.587 1.787.96 2.32a6.43 6.43 0 0 0 2.16 2c.853.427 2.053.64 3.6.64Zm0-23.52c1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c0 1.387-.507 2.56-1.52 3.52-1.014.96-2.134 1.44-3.36 1.44-1.387 0-2.56-.48-3.52-1.44-.96-1.12-1.44-2.293-1.44-3.52 0-1.333.48-2.48 1.44-3.44 1.12-.96 2.293-1.44 3.52-1.44ZM17.33 24.4c3.146 0 5.813.587 8 1.76 2.186 1.173 3.84 2.533 4.96 4.08 1.44 1.653 2.4 3.467 2.88 5.44.533 1.813.8 3.6.8 5.36 0 1.387-.507 2.56-1.52 3.52-1.014.96-2.134 1.44-3.36 1.44-1.387 0-2.56-.48-3.52-1.44-.96-1.12-1.44-2.293-1.44-3.52l-.24-1.92c-.107-.8-.4-1.547-.88-2.24-.427-.747-1.12-1.36-2.08-1.84-.907-.533-2.107-.8-3.6-.8a18.12 18.12 0 0 1-4.24-.48c-1.334-.32-2.534-.72-3.6-1.2-2.187-1.227-3.947-2.667-5.28-4.32-1.28-1.653-2.187-3.413-2.72-5.28a17.09 17.09 0 0 1-.88-5.44c0-1.333.48-2.48 1.44-3.44 1.12-.96 2.293-1.44 3.52-1.44 1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c.106.427.16 1.067.16 1.92.266 1.013.586 1.787.96 2.32a6.43 6.43 0 0 0 2.16 2c.853.427 2.053.64 3.6.64ZM5.57 36.16c1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c0 1.387-.507 2.56-1.52 3.52C7.915 45.52 6.795 46 5.57 46c-1.387 0-2.56-.48-3.52-1.44-.96-1.12-1.44-2.293-1.44-3.52 0-1.333.48-2.48 1.44-3.44 1.12-.96 2.293-1.44 3.52-1.44Zm23.52-23.52c1.333 0 2.48.507 3.44 1.52s1.44 2.133 1.44 3.36c0 1.387-.507 2.56-1.52 3.52-1.014.96-2.134 1.44-3.36 1.44-1.387 0-2.56-.48-3.52-1.44-.96-1.12-1.44-2.293-1.44-3.52 0-1.333.48-2.48 1.44-3.44 1.12-.96 2.293-1.44 3.52-1.44Z"
        ></path>
      </svg>
    </div>
    <div id="message">Loading, please wait...</div>
    <iframe id="ngrokIframe" title="ngrok content"></iframe>

    <script>
      async function loadTunnelIframe() {
        // Get the 'id' parameter from the query string
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");
        const message = document.getElementById("message");

        if (!id) {
          message.textContent = `No "id" parameter found in the query string.`;
          return;
        }

        try {
          // Fetch the data from the API
          const response = await fetch(
            `https://api.jsonbin.io/v3/b/${id}/latest`
          );
          if (!response.ok) {
            throw new Error(`Failed to fetch data: ${response.statusText}`);
          }

          const data = await response.json();

          // Extract the tunnel from the response
          const tunnel = data.record?.tunnel;
          const publicIP = data.record?.publicIP;

          document
            .querySelector(".xtouch-logo-svg")
            .addEventListener("click", () => {
              navigator.clipboard.writeText(publicIP).then(
                function () {
                  console.log("Public IP copied to clipboard");
                },
                function (err) {
                  console.error("Could not copy text: ", err);
                }
              );
            });
          // copy the public IP to the clipboard

          if (!tunnel) {
            throw new Error("tunnel not found in the response.");
          }

          // Set the iframe's src to the tunnel
          const iframe = document.getElementById("ngrokIframe");
          iframe.src = tunnel + "/cameras?autoReload=true";

          // Display a message to the user
          message.textContent =
            "Page loaded successfully. Bookmark this page for later use.";

          setTimeout(() => {
            message.style.display = "none";
          }, 3000); // Hide the message after 5 seconds
        } catch (error) {
          console.error("Error:", error.message);
        }
      }

      // Call the function on page load
      window.onload = loadTunnelIframe;
    </script>
  </body>
</html>
